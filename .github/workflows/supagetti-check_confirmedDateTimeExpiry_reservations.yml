name: Check Waitlisted Reservations

on:
  schedule:
    - cron: '*/20 * * * *' # every 20 minutes
  workflow_dispatch:

jobs:
  check-waitlist:
    runs-on: ubuntu-latest

    steps:
      - name: Check WIB time window (09:00â€“23:00)
        id: timecheck
        run: |
          HOUR=$(TZ=Asia/Jakarta date +'%H')
          if [ "$HOUR" -ge 9 ] && [ "$HOUR" -lt 23 ]; then
            echo "run=true" >> $GITHUB_OUTPUT
          else
            echo "run=false" >> $GITHUB_OUTPUT
          fi

      - name: Call API endpoint
        if: steps.timecheck.outputs.run == 'true'
        run: |
          curl -sS -X GET "https://taratechapi.fly.dev/api/ecosuite/check-waitlisted-reservations-with-confirmedExpiryDateTime-expired/?brandId=ILY79IOQG6"
